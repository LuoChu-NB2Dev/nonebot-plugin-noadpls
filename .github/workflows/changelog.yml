name: Update Changelog

on:
  release:
    types: [published] # 当创建草稿发布时触发

jobs:
  changelog:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - uses: actions/checkout@v4
        with:
          ref: main

      - name: Update changelog
        uses: rhysd/changelog-from-release/action@v3
        with:
          file: CHANGELOG.md
          github_token: ${{ secrets.GITHUB_TOKEN }}
          args: -l 2 -d=true # 包含草稿发布
          header: |
            # Changelog

            本文档记录了项目的所有重要变更。

            格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
            并且本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/)。
